<html>
<head>
<title>The Ada Program: machine_inventory.adb</title>
<!-- Automatically created by 'sgml2html'. -->
</head>
<body>
<h1>The Ada Program: machine_inventory.adb</h1>
<pre>
<font size=-1>  1</font> <b><font color=#228B22>with</font></b> Ada.Calendar, Ada.Direct_IO;
<font size=-1>  2</font> <b><font color=#228B22>with</font></b> <a href="http://www.adahome.com/rm95/rm9x-A-10-01.html">Ada.Text_IO</a>, <a href="http://www.adahome.com/rm95/rm9x-A-10-08.html#20">Ada.Integer_Text_IO</a>, <a href="http://www.adahome.com/rm95/rm9x-A-10-09.html#32">Ada.Float_Text_IO</a>;
<font size=-1>  3</font> <b><font color=#228B22>use</font></b> Ada;
<font size=-1>  4</font> 
<font size=-1>  5</font> <b><font color=#228B22>procedure</font></b> Machine_Inventory <b><font color=#228B22>is</font></b>
<font size=-1>  6</font> 
<font size=-1>  7</font>    <b><i><font color=#BB1212>-- Type for the different user choices</font></i></b>
<font size=-1>  8</font>    <b><font color=#228B22>type</font></b> Choice_Type <b><font color=#228B22>is</font></b> (Add, Failure, Report, Summary, Done);
<font size=-1>  9</font> 
<font size=-1> 10</font>    <b><i><font color=#BB1212>-- Declarations for machine information record</font></i></b>
<font size=-1> 11</font>    Description_Length : <b><font color=#228B22>constant</font></b> := <font color=#008B8B>50</font>;
<font size=-1> 12</font> 
<font size=-1> 13</font>    <b><font color=#228B22>subtype</font></b> Description_String <b><font color=#228B22>is</font></b> <font color=#8B008B>String</font> (<font color=#008B8B>1</font>..Description_Length);
<font size=-1> 14</font> 
<font size=-1> 15</font>    <b><font color=#228B22>type</font></b> Date_Rec <b><font color=#228B22>is</font></b>
<font size=-1> 16</font>       <b><font color=#228B22>record</font></b>
<font size=-1> 17</font>          Month : Calendar.Month_Number;
<font size=-1> 18</font>          Day   : Calendar.Day_Number;
<font size=-1> 19</font>          Year  : Calendar.Year_Number;
<font size=-1> 20</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>record</font></b>;
<font size=-1> 21</font> 
<font size=-1> 22</font>    <b><font color=#228B22>type</font></b> Statistics_Rec <b><font color=#228B22>is</font></b>
<font size=-1> 23</font>       <b><font color=#228B22>record</font></b>
<font size=-1> 24</font>          Fail_Rate     : <font color=#8B008B>Float</font>;
<font size=-1> 25</font>          Last_Serviced : Date_Rec;
<font size=-1> 26</font>          Down_Days     : <font color=#8B008B>Natural</font>;
<font size=-1> 27</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>record</font></b>;
<font size=-1> 28</font> 
<font size=-1> 29</font>    <b><font color=#228B22>type</font></b> Machine_Rec <b><font color=#228B22>is</font></b>
<font size=-1> 30</font>       <b><font color=#228B22>record</font></b>
<font size=-1> 31</font>          ID_Number     : <font color=#8B008B>Natural</font>;
<font size=-1> 32</font>          Description   : Description_String;
<font size=-1> 33</font>          History       : Statistics_Rec;
<font size=-1> 34</font>          Purchase_Date : Date_Rec;
<font size=-1> 35</font>          Cost          : <font color=#8B008B>Float</font>;
<font size=-1> 36</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>record</font></b>;
<font size=-1> 37</font> 
<font size=-1> 38</font>    <b><i><font color=#BB1212>-- Instantiate I/O Packages</font></i></b>
<font size=-1> 39</font>    <b><font color=#228B22>package</font></b> Machine_IO <b><font color=#228B22>is</font></b> <b><font color=#228B22>new</font></b> Direct_IO (Element_Type =&#62; Machine_Rec);
<font size=-1> 40</font>    <b><font color=#228B22>package</font></b> Choice_IO  <b><font color=#228B22>is</font></b> <b><font color=#228B22>new</font></b> Text_IO.Enumeration_IO (Enum =&#62; Choice_Type);
<font size=-1> 41</font> 
<font size=-1> 42</font>    <b><i><font color=#BB1212>-- Procedures</font></i></b>
<font size=-1> 43</font> 
<font size=-1> 44</font>    <b><i><font color=#BB1212>--------------------------------------------------------------------</font></i></b>
<font size=-1> 45</font>    <b><font color=#228B22>procedure</font></b> Prepare_File (Inventory_File : <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type) <b><font color=#228B22>is</font></b>
<font size=-1> 46</font> 
<font size=-1> 47</font>    <b><i><font color=#BB1212>-- This procedure prepares the direct access file containing</font></i></b>
<font size=-1> 48</font>    <b><i><font color=#BB1212>-- the machine information records</font></i></b>
<font size=-1> 49</font> 
<font size=-1> 50</font>    <b><font color=#228B22>begin</font></b>
<font size=-1> 51</font>       Machine_IO.Open (File =&#62; Inventory_File,
<font size=-1> 52</font>                        Mode =&#62; Machine_IO.InOut_File,
<font size=-1> 53</font>                        Name =&#62; <font color=#008B8B>"Machine.Dat"</font>);
<font size=-1> 54</font>    <b><font color=#228B22>exception</font></b>
<font size=-1> 55</font>       <b><font color=#228B22>when</font></b> Machine_IO.Name_Error =&#62;
<font size=-1> 56</font>          Text_IO.Put_Line (<font color=#008B8B>"Inventory file does not exist"</font>);
<font size=-1> 57</font>          Text_IO.Put_Line (<font color=#008B8B>"Creating the inventory file Machine.Dat"</font>);
<font size=-1> 58</font>          Machine_IO.Create (File =&#62; Inventory_File,
<font size=-1> 59</font>                             Mode =&#62; Machine_IO.InOut_File,
<font size=-1> 60</font>                             Name =&#62; <font color=#008B8B>"Machine.Dat"</font>);
<font size=-1> 61</font>    <b><font color=#228B22>end</font></b> Prepare_File;
<font size=-1> 62</font> 
<font size=-1> 63</font> 
<font size=-1> 64</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------</font></i></b>
<font size=-1> 65</font>    <b><font color=#228B22>procedure</font></b> Get_Choice (Choice : <b><font color=#228B22>out</font></b> Choice_Type) <b><font color=#228B22>is</font></b>
<font size=-1> 66</font> 
<font size=-1> 67</font>    <b><i><font color=#BB1212>-- This procedure asks the user what type of Choice they want to</font></i></b>
<font size=-1> 68</font>    <b><i><font color=#BB1212>-- do and gets it from them.  Invalid input is handled.</font></i></b>
<font size=-1> 69</font> 
<font size=-1> 70</font>    <b><font color=#228B22>begin</font></b>
<font size=-1> 71</font>       Text_IO.New_Line (<font color=#008B8B>2</font>);
<font size=-1> 72</font>       Text_IO.Put_Line (<font color=#008B8B>"The following operations are available:"</font>);
<font size=-1> 73</font>       Text_IO.Put_Line (<font color=#008B8B>"  Add     - Add a new machine to the inventory"</font>);
<font size=-1> 74</font>       Text_IO.Put_Line (<font color=#008B8B>"  Failure - Update a machine's failure information"</font>);
<font size=-1> 75</font>       Text_IO.Put_Line (<font color=#008B8B>"  Report  - Report all information for one machine"</font>);
<font size=-1> 76</font>       Text_IO.Put_Line (<font color=#008B8B>"  Summary - Report all the information for the "</font> &#38;
<font size=-1> 77</font>                                         <font color=#008B8B>"most failure prone machines"</font>);
<font size=-1> 78</font>       Text_IO.Put_Line (<font color=#008B8B>"  Done    - Exit this program"</font>);
<font size=-1> 79</font>       Text_IO.New_Line;
<font size=-1> 80</font>       Input_Loop:  <b><i><font color=#BB1212>-- Each iteration, one input value is checked</font></i></b>
<font size=-1> 81</font>       <b><font color=#228B22>loop</font></b>
<font size=-1> 82</font>          Text_IO.Put (<font color=#008B8B>"Enter your choice:   "</font>);
<font size=-1> 83</font> 
<font size=-1> 84</font>          Validation_Block:  <b><i><font color=#BB1212>-- To handle invalid input values</font></i></b>
<font size=-1> 85</font>          <b><font color=#228B22>begin</font></b>
<font size=-1> 86</font>             Choice_IO.Get (Choice);
<font size=-1> 87</font>             <b><font color=#228B22>exit</font></b> Input_Loop;
<font size=-1> 88</font>          <b><font color=#228B22>exception</font></b>
<font size=-1> 89</font>             <b><font color=#228B22>when</font></b> Text_IO.DATA_ERROR =&#62;
<font size=-1> 90</font>                Text_IO.Put_Line (<font color=#008B8B>"Invalid choice, please try again."</font>);
<font size=-1> 91</font>          <b><font color=#228B22>end</font></b> Validation_Block;
<font size=-1> 92</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>loop</font></b> Input_Loop;
<font size=-1> 93</font>    <b><font color=#228B22>end</font></b> Get_Choice;
<font size=-1> 94</font> 
<font size=-1> 95</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1> 96</font>    <b><font color=#228B22>procedure</font></b> Get_Today (Today : <b><font color=#228B22>out</font></b> Date_Rec) <b><font color=#228B22>is</font></b>
<font size=-1> 97</font> 
<font size=-1> 98</font>    <b><i><font color=#BB1212>-- This procedure gets today's date from the system clock/calendar</font></i></b>
<font size=-1> 99</font> 
<font size=-1>100</font>       Clock_Value : Calendar.Time;  <b><i><font color=#BB1212>-- The system clock reading</font></i></b>
<font size=-1>101</font> 
<font size=-1>102</font>    <b><font color=#228B22>begin</font></b>   <b><i><font color=#BB1212>-- Get_Today</font></i></b>
<font size=-1>103</font>       Clock_Value := Calendar.Clock;  <b><i><font color=#BB1212>-- Clock is a function in package Calendar</font></i></b>
<font size=-1>104</font>       <b><i><font color=#BB1212>-- Convert the clock value to Year, Month, and Day</font></i></b>
<font size=-1>105</font>       Today.Month := Calendar.Month (Clock_Value); <b><i><font color=#BB1212>-- Functions</font></i></b>
<font size=-1>106</font>       Today.Day   := Calendar.Day   (Clock_Value); <b><i><font color=#BB1212>-- in package</font></i></b>
<font size=-1>107</font>       Today.Year  := Calendar.Year  (Clock_Value); <b><i><font color=#BB1212>-- Calendar</font></i></b>
<font size=-1>108</font>    <b><font color=#228B22>end</font></b> Get_Today;
<font size=-1>109</font> 
<font size=-1>110</font> 
<font size=-1>111</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------</font></i></b>
<font size=-1>112</font>    <b><font color=#228B22>procedure</font></b> New_Machine (Inventory_File: <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type)
<font size=-1>113</font>       <b><font color=#228B22>is</font></b> <b><font color=#228B22>separate</font></b>;
<font size=-1>114</font> 
<font size=-1>115</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>116</font>    <b><font color=#228B22>procedure</font></b> Find_Machine
<font size=-1>117</font>          (File    : <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type; <b><i><font color=#BB1212>-- Inventory File</font></i></b>
<font size=-1>118</font>           ID      : <b><font color=#228B22>in</font></b>     <font color=#8B008B>Natural</font>;              <b><i><font color=#BB1212>-- ID of desired record</font></i></b>
<font size=-1>119</font>           Machine :    <b><font color=#228B22>out</font></b> Machine_Rec;          <b><i><font color=#BB1212>-- The machine record</font></i></b>
<font size=-1>120</font>           Found   :    <b><font color=#228B22>out</font></b> <font color=#8B008B>Boolean</font>;              <b><i><font color=#BB1212>-- True if record found</font></i></b>
<font size=-1>121</font>           Index   :    <b><font color=#228B22>out</font></b> Machine_IO.Count)     <b><i><font color=#BB1212>-- The file index of the record</font></i></b>
<font size=-1>122</font>       <b><font color=#228B22>is</font></b> <b><font color=#228B22>separate</font></b>;
<font size=-1>123</font> 
<font size=-1>124</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>125</font>    <b><font color=#228B22>procedure</font></b> Update_Failure (Inventory_File : <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type) <b><font color=#228B22>is</font></b>
<font size=-1>126</font> 
<font size=-1>127</font>    <b><i><font color=#BB1212>-- This procedure updates the information for a machine that has failed</font></i></b>
<font size=-1>128</font> 
<font size=-1>129</font>       Machine    : Machine_Rec;       <b><i><font color=#BB1212>-- Information record for the machine</font></i></b>
<font size=-1>130</font>       Machine_ID : <font color=#8B008B>Natural</font>;           <b><i><font color=#BB1212>-- The ID number of the machine</font></i></b>
<font size=-1>131</font>       Valid_ID   : <font color=#8B008B>Boolean</font>;           <b><i><font color=#BB1212>-- True if the machine ID is on file</font></i></b>
<font size=-1>132</font>       Days       : <font color=#8B008B>Natural</font>;           <b><i><font color=#BB1212>-- Days down this failure</font></i></b>
<font size=-1>133</font>       File_Index : Machine_IO.Count;  <b><i><font color=#BB1212>-- The position of the desired record</font></i></b>
<font size=-1>134</font>                                       <b><i><font color=#BB1212>-- in the inventory file</font></i></b>
<font size=-1>135</font> 
<font size=-1>136</font>    <b><font color=#228B22>begin</font></b>  <b><i><font color=#BB1212>-- Update Failure</font></i></b>
<font size=-1>137</font>       Text_IO.Put_Line (<font color=#008B8B>"Enter the ID number of the machine that failed."</font>);
<font size=-1>138</font>       Integer_Text_IO.Get (Machine_ID);
<font size=-1>139</font>       Find_Machine (File    =&#62; Inventory_File,  <b><i><font color=#BB1212>-- Get the current information</font></i></b>
<font size=-1>140</font>                     ID      =&#62; Machine_ID,      <b><i><font color=#BB1212>-- for the machine</font></i></b>
<font size=-1>141</font>                     Machine =&#62; Machine,
<font size=-1>142</font>                     Found   =&#62; Valid_ID,
<font size=-1>143</font>                     Index   =&#62; File_Index);
<font size=-1>144</font>       <b><font color=#228B22>if</font></b> Valid_ID <b><font color=#228B22>then</font></b>  <b><i><font color=#BB1212>-- Got the machine record, now modify it</font></i></b>
<font size=-1>145</font>          Text_IO.Put_Line (<font color=#008B8B>"Enter the new failure rate."</font>);
<font size=-1>146</font>          Float_Text_IO.Get (Machine.History.Fail_Rate);
<font size=-1>147</font>          Text_IO.Put_Line (<font color=#008B8B>"Enter the number of days the machine was down "</font> &#38;
<font size=-1>148</font>                            <font color=#008B8B>"for this failure."</font>);
<font size=-1>149</font>          Integer_Text_IO.Get (Days);
<font size=-1>150</font>          Machine.History.Down_Days := Machine.History.Down_Days + Days;
<font size=-1>151</font>          <b><i><font color=#BB1212>-- Get Today's date and put it into the last service date</font></i></b>
<font size=-1>152</font>          Get_Today (Today =&#62; Machine.History.Last_Serviced);
<font size=-1>153</font>          <b><i><font color=#BB1212>-- Put the modified record back in the file</font></i></b>
<font size=-1>154</font>          Machine_IO.Write (File =&#62; Inventory_File,
<font size=-1>155</font>                            Item =&#62; Machine,
<font size=-1>156</font>                            To   =&#62; File_Index);
<font size=-1>157</font>       <b><font color=#228B22>else</font></b>   <b><i><font color=#BB1212>-- Search of file was not successful</font></i></b>
<font size=-1>158</font>          Text_IO.Put (<font color=#008B8B>"Unable to find Machine ID #"</font>);
<font size=-1>159</font>          Integer_Text_IO.Put (Item  =&#62; Machine_ID,
<font size=-1>160</font>                          Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>161</font>          Text_IO.Put_Line (<font color=#008B8B>" in the inventory file."</font>);
<font size=-1>162</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>if</font></b>;
<font size=-1>163</font>    <b><font color=#228B22>end</font></b> Update_Failure;
<font size=-1>164</font> 
<font size=-1>165</font> 
<font size=-1>166</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>167</font>    <b><font color=#228B22>procedure</font></b> Put_Date (Date : <b><font color=#228B22>in</font></b> Date_Rec) <b><font color=#228B22>is</font></b>  <b><i><font color=#BB1212>-- The date to display</font></i></b>
<font size=-1>168</font> 
<font size=-1>169</font>    <b><i><font color=#BB1212>-- This procedure displays the given date</font></i></b>
<font size=-1>170</font> 
<font size=-1>171</font>    <b><font color=#228B22>begin</font></b>
<font size=-1>172</font>       Integer_Text_IO.Put (Item =&#62; Date.Month,
<font size=-1>173</font>                       Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>174</font>       Text_IO.Put (<font color=#008B8B>'/'</font>);
<font size=-1>175</font>       Integer_Text_IO.Put (Item =&#62; Date.Day,
<font size=-1>176</font>                       Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>177</font>       Text_IO.Put (<font color=#008B8B>'/'</font>);
<font size=-1>178</font>       Integer_Text_IO.Put (Item =&#62; Date.Year <b><font color=#228B22>rem</font></b> <font color=#008B8B>100</font>,
<font size=-1>179</font>                       Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>180</font>    <b><font color=#228B22>end</font></b> Put_Date;
<font size=-1>181</font> 
<font size=-1>182</font> 
<font size=-1>183</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>184</font>    <b><font color=#228B22>procedure</font></b> Put_Machine (Machine : <b><font color=#228B22>in</font></b> Machine_Rec) <b><font color=#228B22>is</font></b>
<font size=-1>185</font> 
<font size=-1>186</font>    <b><i><font color=#BB1212>-- This procedure displays the information in a machine record</font></i></b>
<font size=-1>187</font> 
<font size=-1>188</font>    <b><font color=#228B22>begin</font></b>   <b><i><font color=#BB1212>-- Put Machine</font></i></b>
<font size=-1>189</font>       Text_IO.Put_Line (Machine.Description);
<font size=-1>190</font>       Text_IO.Put (<font color=#008B8B>"   ID number      : "</font>);
<font size=-1>191</font>       Integer_Text_IO.Put (Item =&#62; Machine.ID_Number, Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>192</font>       Text_IO.New_Line;
<font size=-1>193</font>       Text_IO.Put (<font color=#008B8B>"   Failure rate   : "</font>);
<font size=-1>194</font>       Float_Text_IO.Put (Item =&#62; Machine.History.Fail_Rate,
<font size=-1>195</font>                     Fore =&#62; <font color=#008B8B>1</font>,
<font size=-1>196</font>                     Aft  =&#62; <font color=#008B8B>2</font>,
<font size=-1>197</font>                     Exp  =&#62; <font color=#008B8B>0</font>);
<font size=-1>198</font>       Text_IO.New_Line;
<font size=-1>199</font>       Text_IO.Put (<font color=#008B8B>"   Last serviced  : "</font>);
<font size=-1>200</font>       Put_Date (Machine.History.Last_Serviced);
<font size=-1>201</font>       Text_IO.New_Line;
<font size=-1>202</font>       Text_IO.Put (<font color=#008B8B>"   Days down      : "</font>);
<font size=-1>203</font>       Integer_Text_IO.Put (Item =&#62; Machine.History.Down_Days,
<font size=-1>204</font>                       Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>205</font>       Text_IO.New_Line;
<font size=-1>206</font>       Text_IO.Put (<font color=#008B8B>"   Purchased      : "</font>);
<font size=-1>207</font>       Put_Date (Machine.Purchase_Date);
<font size=-1>208</font>       Text_IO.New_Line;
<font size=-1>209</font>       Text_IO.Put (<font color=#008B8B>"   Purchase price : $"</font>);
<font size=-1>210</font>       Float_Text_IO.Put (Item =&#62; Machine.Cost,
<font size=-1>211</font>                     Fore =&#62; <font color=#008B8B>1</font>,
<font size=-1>212</font>                     Aft  =&#62; <font color=#008B8B>2</font>,
<font size=-1>213</font>                     Exp  =&#62; <font color=#008B8B>0</font>);
<font size=-1>214</font>       Text_IO.New_Line;
<font size=-1>215</font>    <b><font color=#228B22>end</font></b> Put_Machine;
<font size=-1>216</font> 
<font size=-1>217</font> 
<font size=-1>218</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>219</font>    <b><font color=#228B22>procedure</font></b> Display_One_Machine (Inventory_File : <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type) <b><font color=#228B22>is</font></b>
<font size=-1>220</font> 
<font size=-1>221</font>    <b><i><font color=#BB1212>-- This procedure displays all of the information for a single machine</font></i></b>
<font size=-1>222</font> 
<font size=-1>223</font>       Machine    : Machine_Rec;       <b><i><font color=#BB1212>-- Information record for the machine</font></i></b>
<font size=-1>224</font>       Machine_ID : <font color=#8B008B>Natural</font>;           <b><i><font color=#BB1212>-- The ID number of the machine</font></i></b>
<font size=-1>225</font>       Valid_ID   : <font color=#8B008B>Boolean</font>;           <b><i><font color=#BB1212>-- True if the machine ID is on file</font></i></b>
<font size=-1>226</font>       File_Index : Machine_IO.Count;  <b><i><font color=#BB1212>-- The position of the desired record</font></i></b>
<font size=-1>227</font>                                       <b><i><font color=#BB1212>-- in the inventory file</font></i></b>
<font size=-1>228</font> 
<font size=-1>229</font> 
<font size=-1>230</font>    <b><font color=#228B22>begin</font></b>  <b><i><font color=#BB1212>-- Display One Machine</font></i></b>
<font size=-1>231</font>       Text_IO.Put_Line (<font color=#008B8B>"Enter the ID Number of the machine."</font>);
<font size=-1>232</font>       Integer_Text_IO.Get (Machine_ID);
<font size=-1>233</font>       Find_Machine (File    =&#62; Inventory_File,  <b><i><font color=#BB1212>-- Get the current information</font></i></b>
<font size=-1>234</font>                     ID      =&#62; Machine_ID,      <b><i><font color=#BB1212>-- for the machine</font></i></b>
<font size=-1>235</font>                     Machine =&#62; Machine,
<font size=-1>236</font>                     Found   =&#62; Valid_ID,
<font size=-1>237</font>                     Index   =&#62; File_Index);
<font size=-1>238</font>       <b><font color=#228B22>if</font></b> Valid_ID <b><font color=#228B22>then</font></b>  <b><i><font color=#BB1212>-- Got the machine record, now display it</font></i></b>
<font size=-1>239</font>          Put_Machine (Machine);
<font size=-1>240</font>       <b><font color=#228B22>else</font></b>   <b><i><font color=#BB1212>-- Search of file was not successful</font></i></b>
<font size=-1>241</font>          Text_IO.Put (<font color=#008B8B>"Unable to find Machine ID #"</font>);
<font size=-1>242</font>          Integer_Text_IO.Put (Item  =&#62; Machine_ID,
<font size=-1>243</font>                          Width =&#62; <font color=#008B8B>1</font>);
<font size=-1>244</font>          Text_IO.Put_Line (<font color=#008B8B>" in the inventory file."</font>);
<font size=-1>245</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>if</font></b>;
<font size=-1>246</font>    <b><font color=#228B22>end</font></b> Display_One_Machine;
<font size=-1>247</font> 
<font size=-1>248</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>249</font>    <b><font color=#228B22>procedure</font></b> Produce_Failure_Report
<font size=-1>250</font>          (Inventory_File : <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type) <b><font color=#228B22>is</font></b>
<font size=-1>251</font> 
<font size=-1>252</font>    <b><i><font color=#BB1212>-- This procedure produces a report on all machines whose</font></i></b>
<font size=-1>253</font>    <b><i><font color=#BB1212>-- failure rate is greater than that specified by the user</font></i></b>
<font size=-1>254</font> 
<font size=-1>255</font>       Threshold : <font color=#8B008B>Float</font>;         <b><i><font color=#BB1212>-- Fail rate cut off for report</font></i></b>
<font size=-1>256</font>       Machine   : Machine_Rec;   <b><i><font color=#BB1212>-- Information on one machine</font></i></b>
<font size=-1>257</font> 
<font size=-1>258</font>    <b><font color=#228B22>begin</font></b>
<font size=-1>259</font>       Text_IO.Put_Line (<font color=#008B8B>"Enter failure threshold for report."</font>);
<font size=-1>260</font>       Float_Text_IO.Get (Threshold);
<font size=-1>261</font> 
<font size=-1>262</font>       Machine_IO.Set_Index (File =&#62; Inventory_File, To =&#62; <font color=#008B8B>1</font>);
<font size=-1>263</font> 
<font size=-1>264</font>       Search_Loop:  <b><i><font color=#BB1212>-- Each iteration, one machine's failure rate is checked</font></i></b>
<font size=-1>265</font>       <b><font color=#228B22>loop</font></b>
<font size=-1>266</font>          <b><font color=#228B22>exit</font></b> Search_Loop <b><font color=#228B22>when</font></b> Machine_IO.End_Of_File (Inventory_File);
<font size=-1>267</font>          Machine_IO.Read (File =&#62; Inventory_File,
<font size=-1>268</font>                           Item =&#62; Machine);
<font size=-1>269</font>          <b><font color=#228B22>if</font></b> Machine.History.Fail_Rate &#62;= Threshold <b><font color=#228B22>then</font></b>
<font size=-1>270</font>             Put_Machine (Machine);
<font size=-1>271</font>          <b><font color=#228B22>end</font></b> <b><font color=#228B22>if</font></b>;
<font size=-1>272</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>loop</font></b> Search_Loop;
<font size=-1>273</font>    <b><font color=#228B22>end</font></b> Produce_Failure_Report;
<font size=-1>274</font> 
<font size=-1>275</font> 
<font size=-1>276</font>    <b><i><font color=#BB1212>-----------------------------------------------------------------------------</font></i></b>
<font size=-1>277</font>    <b><font color=#228B22>procedure</font></b> Process_Choice
<font size=-1>278</font>          (Which_Choice   : <b><font color=#228B22>in</font></b>     Choice_Type;              <b><i><font color=#BB1212>-- User request</font></i></b>
<font size=-1>279</font>           Inventory_File : <b><font color=#228B22>in</font></b> <b><font color=#228B22>out</font></b> Machine_IO.File_Type) <b><font color=#228B22>is</font></b>  <b><i><font color=#BB1212>-- Inventory file</font></i></b>
<font size=-1>280</font> 
<font size=-1>281</font>    <b><font color=#228B22>begin</font></b>   <b><i><font color=#BB1212>-- Process Choice</font></i></b>
<font size=-1>282</font>       <b><font color=#228B22>if</font></b> Which_Choice = Add <b><font color=#228B22>then</font></b>
<font size=-1>283</font>          New_Machine (Inventory_File);
<font size=-1>284</font>       <b><font color=#228B22>elsif</font></b> Which_Choice = Failure <b><font color=#228B22>then</font></b>
<font size=-1>285</font>          Update_Failure (Inventory_File);
<font size=-1>286</font>       <b><font color=#228B22>elsif</font></b> Which_Choice = Report <b><font color=#228B22>then</font></b>
<font size=-1>287</font>          Display_One_Machine (Inventory_File);
<font size=-1>288</font>       <b><font color=#228B22>else</font></b> <b><i><font color=#BB1212>-- Which_Choice = Summary</font></i></b>
<font size=-1>289</font>          Produce_Failure_Report (Inventory_File);
<font size=-1>290</font>       <b><font color=#228B22>end</font></b> <b><font color=#228B22>if</font></b>;
<font size=-1>291</font>    <b><font color=#228B22>end</font></b> Process_Choice;
<font size=-1>292</font> 
<font size=-1>293</font>    <b><i><font color=#BB1212>-- Main program variables</font></i></b>
<font size=-1>294</font>    Choice         : Choice_Type;           <b><i><font color=#BB1212>-- User request</font></i></b>
<font size=-1>295</font>    Inventory_File : Machine_IO.File_Type;  <b><i><font color=#BB1212>-- Machine inventory records</font></i></b>
<font size=-1>296</font> 
<font size=-1>297</font> 
<font size=-1>298</font> <b><i><font color=#BB1212>-----------------------------------</font></i></b>
<font size=-1>299</font> <b><font color=#228B22>begin</font></b>  <b><i><font color=#BB1212>-- Program Machine Inventory</font></i></b>
<font size=-1>300</font> 
<font size=-1>301</font>    Prepare_File (Inventory_File);
<font size=-1>302</font> 
<font size=-1>303</font>    Choice_Loop:  <b><i><font color=#BB1212>-- Each iteration, one user request is processed</font></i></b>
<font size=-1>304</font>    <b><font color=#228B22>loop</font></b>
<font size=-1>305</font>       Get_Choice (Choice);
<font size=-1>306</font>       <b><font color=#228B22>exit</font></b> Choice_Loop <b><font color=#228B22>when</font></b> Choice = Done;
<font size=-1>307</font>       Process_Choice (Which_Choice   =&#62; Choice,
<font size=-1>308</font>                       Inventory_File =&#62; Inventory_File);
<font size=-1>309</font>    <b><font color=#228B22>end</font></b> <b><font color=#228B22>loop</font></b> Choice_Loop;
<font size=-1>310</font>    <b><i><font color=#BB1212>-- Close the file</font></i></b>
<font size=-1>311</font>    Machine_IO.Close (Inventory_File);
<font size=-1>312</font> 
<font size=-1>313</font> <b><font color=#228B22>exception</font></b>
<font size=-1>314</font>    <b><font color=#228B22>when</font></b> <b><font color=#228B22>others</font></b> =&#62;                        <b><i><font color=#BB1212>-- If any exception is not handled where</font></i></b>
<font size=-1>315</font>       Machine_IO.Close (Inventory_File); <b><i><font color=#BB1212>-- it occurs, close the file and propogate</font></i></b>
<font size=-1>316</font>       <b><font color=#228B22>raise</font></b>;                             <b><i><font color=#BB1212>-- the exception back to the system.</font></i></b>
<font size=-1>317</font> <b><font color=#228B22>end</font></b> Machine_Inventory;
</pre>
</body>
</html>
