<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>The Ada Program: diff.adb</title>
<!-- Automatically created by 'sgml2html'. -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
  .key         {font-weight:bold; color:#228B22;}
  .comment     {font-style:oblique; font-weight:bold; color:#BB1212;}
  .linenumber  {font-size:75%;    color:#888888;}
  .string      {color:#3333CC;}
  .char        {color:#3333CC;}
  .number      {color:#3333CC;}
  .predefined  {color:#3333CC;}
</style>
</head>
<body>
<h1>The Ada Program: diff.adb</h1>
<pre>
<span class="linenumber">  1</span> <span class="comment">-- diff.adb:  environment pointer is necessary in closure</span>
<span class="linenumber">  2</span> 
<span class="linenumber">  3</span> <span class="key">procedure</span> Diff <span class="key">is</span>
<span class="linenumber">  4</span> 
<span class="linenumber">  5</span>    <span class="comment">-- the environment in which "P" is defined is "Diff"</span>
<span class="linenumber">  6</span>    <span class="key">procedure</span> P (X: <span class="predefined">Integer</span>) <span class="key">is</span> <span class="key">begin</span> <span class="key">null</span>; <span class="key">end</span> P;
<span class="linenumber">  7</span> 
<span class="linenumber">  8</span>    <span class="key">procedure</span> R <span class="key">is</span>
<span class="linenumber">  9</span> 
<span class="linenumber"> 10</span>       N: <span class="predefined">Integer</span>;  <span class="comment">-- variable accessed nonlocally by "T"</span>
<span class="linenumber"> 11</span> 
<span class="linenumber"> 12</span>       <span class="comment">-- the environment in which "T" is defined is "R"</span>
<span class="linenumber"> 13</span>       <span class="key">procedure</span> T (X: <span class="predefined">Integer</span>) <span class="key">is</span> <span class="key">begin</span> N:=X; <span class="key">end</span> T;
<span class="linenumber"> 14</span> 
<span class="linenumber"> 15</span>       <span class="key">type</span> F <span class="key">is</span> <span class="key">access</span> <span class="key">procedure</span> (X: <span class="predefined">Integer</span>);
<span class="linenumber"> 16</span>       <span class="key">procedure</span> Q (FP: F) <span class="key">is</span> <span class="key">begin</span> FP(<span class="number">5</span>); <span class="key">end</span> Q;
<span class="linenumber"> 17</span> 
<span class="linenumber"> 18</span>    <span class="key">begin</span>
<span class="linenumber"> 19</span>       Q (P<span class="predefined">'Access</span>);  <span class="comment">-- no problem</span>
<span class="linenumber"> 20</span>       Q (T<span class="predefined">'Access</span>);  <span class="comment">-- no problem</span>
<span class="linenumber"> 21</span>    <span class="key">end</span> R;
<span class="linenumber"> 22</span> 
<span class="linenumber"> 23</span> <span class="key">begin</span>
<span class="linenumber"> 24</span>    R;
<span class="linenumber"> 25</span> <span class="key">end</span> Diff;
<span class="linenumber"> 26</span> 
<span class="linenumber"> 27</span> <span class="comment">--  The stack of pending calls during the execution of</span>
<span class="linenumber"> 28</span> <span class="comment">--  the main program "Diff" (abbreviated as D below):</span>
<span class="linenumber"> 29</span> <span class="comment">--</span>
<span class="linenumber"> 30</span> <span class="comment">--              FP=P          FP=T</span>
<span class="linenumber"> 31</span> <span class="comment">--            Q   Q   Q     Q   Q   Q</span>
<span class="linenumber"> 32</span> <span class="comment">--         R  R   R   R  R  R   R   R  R</span>
<span class="linenumber"> 33</span> <span class="comment">--      D  D  D   D   D  D  D   D   D  D  D</span>
<span class="linenumber"> 34</span> <span class="comment">--</span>
<span class="linenumber"> 35</span> <span class="comment">--   begin         == time ==&#62;          end</span>
</pre>
</body>
</html>
